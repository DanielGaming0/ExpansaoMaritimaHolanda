<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElsonAvalia - Sistema de Avaliação Física</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS INCORPORADO -->
    <style>
        :root {
            /* Tema Padrão (Dark) */
            --accent-gradient: linear-gradient(90deg, #00F260, #0575E6);
            --bg-image: linear-gradient(315deg, #243B55, #141E30);
            --card-bg-color: rgba(255, 255, 255, 0.05);
            --card-border-color: rgba(255, 255, 255, 0.1);
            --text-primary-color: #ffffff;
            --text-secondary-color: #a0aec0;
            --input-bg-color: rgba(0, 0, 0, 0.2);
            --input-border-color: rgba(255, 255, 255, 0.2);
            --shadow-color: rgba(0, 0, 0, 0.3);
            --danger-color: #e53e3e;
            --success-color: #38a169;
            --draft-color: #718096;
        }

        [data-theme='light'] {
            --accent-gradient: linear-gradient(90deg, #00c66c, #0072ff);
            --bg-image: linear-gradient(315deg, #e2e8f0, #f8fafc);
            --card-bg-color: rgba(255, 255, 255, 0.7);
            --card-border-color: rgba(0, 0, 0, 0.08);
            --text-primary-color: #1a202c;
            --text-secondary-color: #4a5568;
            --input-bg-color: rgba(0, 0, 0, 0.04);
            --input-border-color: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text-primary-color);
            background-image: var(--bg-image);
            background-attachment: fixed;
            background-size: cover;
            transition: background-image 0.5s ease, color 0.5s ease;
            overflow-x: hidden;
        }
        
        /* --- LAYOUT E CABEÇALHO --- */
        .top-bar {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg-color);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--card-border-color);
        }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--text-primary-color); }

        .container { max-width: 900px; margin: 1rem auto; padding: 1rem; }
        header { text-align: center; margin-bottom: 3rem; animation: fadeInDown 1s ease-out; }
        header h1 { font-size: 3.5rem; font-weight: 700; letter-spacing: 1px; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        header p { color: var(--text-secondary-color); font-size: 1.1rem; margin-top: 0.5rem; }

        /* --- CARD DE VIDRO --- */
        .card {
            background: var(--card-bg-color);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--card-border-color);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px 0 var(--shadow-color);
            transition: transform 0.3s ease;
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
        }
        .card:hover { transform: translateY(-8px); }
        .card h2 { font-size: 1.6rem; color: var(--text-primary-color); margin-bottom: 2rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--card-border-color); font-weight: 600; }
        
        /* --- BOTÕES E FORMULÁRIOS --- */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.75rem; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-align: center; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); }
        .btn:active { transform: translateY(-1px) scale(0.98); }
        .btn-primary { background: var(--accent-gradient); color: white; width: 100%; padding: 1rem; font-size: 1.1rem; }
        
        .input-group input, .input-group select { width: 100%; padding: 1rem; background: var(--input-bg-color); border: 1px solid var(--input-border-color); border-radius: 12px; font-size: 1rem; color: var(--text-primary-color); font-family: 'Poppins', sans-serif; transition: all 0.3s ease; }
        .input-group select option { background-color: #2d3748; }
        [data-theme='light'] .input-group select option { background-color: #fff; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #0575E6; box-shadow: 0 0 0 3px rgba(5, 117, 230, 0.3); }

        /* --- MENU DE CONFIGURAÇÕES (PAINEL LATERAL) --- */
        .settings-btn { background: transparent; border: none; cursor: pointer; }
        .settings-btn svg { width: 30px; height: 30px; stroke: var(--text-primary-color); }
        .settings-panel { position: fixed; top: 0; right: -350px; width: 320px; height: 100%; background: var(--card-bg-color); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-left: 1px solid var(--card-border-color); box-shadow: -10px 0 30px rgba(0,0,0,0.2); z-index: 200; transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); padding: 1.5rem; }
        .settings-panel.active { right: 0; }
        .settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .settings-header h2 { font-size: 1.5rem; color: var(--text-primary-color); }
        .settings-section { margin-bottom: 2rem; }
        .settings-section h3 { margin-bottom: 1rem; color: var(--text-secondary-color); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }

        /* Theme Toggle Switch */
        .theme-switch-wrapper { display: flex; align-items: center; justify-content: space-between; }
        .theme-switch { display: inline-block; height: 34px; position: relative; width: 60px; }
        .theme-switch input { display:none; }
        .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; }
        .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 26px; left: 4px; position: absolute; transition: .4s; width: 26px; }
        input:checked + .slider { background-image: var(--accent-gradient); }
        input:checked + .slider:before { transform: translateX(26px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 199; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; }
        .overlay.active { opacity: 1; pointer-events: all; }

        /* --- OUTROS ESTILOS --- */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; }
        .form-actions { display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap; }
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 1.2rem 1.5rem; background: var(--input-bg-color); border-radius: 12px; border-left: 4px solid transparent; transition: all 0.3s ease; }
        .history-item:hover { transform: translateX(10px); border-left: 4px solid #00F260; }
        #final-grade { background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hidden { display: none !important; }
        
        /* ANIMAÇÕES */
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body data-theme="dark">

    <div class="top-bar">
        <span class="logo">ElsonAvalia</span>
        <button class="settings-btn" id="openSettingsBtn">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
        </button>
    </div>

    <aside class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2>Configurações</h2>
            <button class="settings-btn" id="closeSettingsBtn" style="transform: scale(0.8);">&times;</button>
        </div>
        <div class="settings-section">
            <h3>Perfil</h3>
            <div class="input-group"><label for="profileName">Seu Nome</label><input type="text" id="profileName" placeholder="Ex: Prof. Elson"></div>
        </div>
        <div class="settings-section">
            <h3>Design</h3>
            <div class="theme-switch-wrapper"><span id="themeLabel">Tema Escuro</span><label class="theme-switch"><input type="checkbox" id="themeToggle"><span class="slider round"></span></label></div>
        </div>
        <div class="settings-section">
            <h3>Gerenciar Dados</h3>
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                <button class="btn btn-secondary" id="exportDataBtn">Exportar Backup</button>
                <button class="btn btn-secondary" id="importDataBtn">Importar Backup</button>
                <input type="file" id="importFileInput" class="hidden" accept=".json">
                <button class="btn" id="clearDataBtn" style="background-color: var(--danger-color); color: white;">Limpar Histórico</button>
            </div>
        </div>
    </aside>
    <div class="overlay" id="overlay"></div>

    <div class="container">
        <!-- TELA PRINCIPAL (MENU) -->
        <main id="mainMenu">
            <header><h1>ElsonAvalia</h1><p>A nova era das avaliações físicas.</p></header>
            <section class="menu-actions card"><button id="btnNewEvaluation" class="btn btn-primary">Iniciar Nova Avaliação</button></section>
            <section class="card" id="historySection"><h2>Histórico de Avaliações</h2><div id="historyList"></div><p id="emptyHistoryMessage" class="hidden">Nenhuma avaliação encontrada.</p></section>
        </main>
        <!-- TELA DE AVALIAÇÃO (FORMULÁRIO) -->
        <main id="evaluationScreen" class="hidden">
            <form id="evaluationForm" data-evaluation-id="">
                <section class="card">
                    <h2 style="animation-delay: 0.1s;">Dados do Aluno</h2>
                    <!-- Campos do formulário aqui -->
                </section>
                <!-- Outras seções do formulário -->
                <div class="form-actions"><button type="button" id="btnBackToMenu" class="btn btn-secondary">Voltar</button><button type="button" id="btnSaveDraft" class="btn btn-secondary">Salvar Rascunho</button><button type="submit" class="btn btn-primary">Calcular e Salvar</button></div>
            </form>
        </main>
        <!-- TELA DE RESULTADOS -->
        <section id="results" class="card hidden">
            <!-- Conteúdo dos resultados -->
        </section>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- SELETORES DO DOM ---
            const body = document.body;
            const mainMenu = document.getElementById('mainMenu');
            const evaluationScreen = document.getElementById('evaluationScreen');
            const resultsScreen = document.getElementById('results');
            const form = document.getElementById('evaluationForm');
            const historyList = document.getElementById('historyList');
            const emptyHistoryMessage = document.getElementById('emptyHistoryMessage');

            // Botões de navegação e ação
            const btnNewEvaluation = document.getElementById('btnNewEvaluation');
            const btnBackToMenu = document.getElementById('btnBackToMenu');
            const btnSaveDraft = document.getElementById('btnSaveDraft');
            
            // Elementos de Configurações
            const openSettingsBtn = document.getElementById('openSettingsBtn');
            const closeSettingsBtn = document.getElementById('closeSettingsBtn');
            const settingsPanel = document.getElementById('settingsPanel');
            const overlay = document.getElementById('overlay');
            const themeToggle = document.getElementById('themeToggle');
            const themeLabel = document.getElementById('themeLabel');
            const profileNameInput = document.getElementById('profileName');
            const exportDataBtn = document.getElementById('exportDataBtn');
            const importDataBtn = document.getElementById('importDataBtn');
            const importFileInput = document.getElementById('importFileInput');
            const clearDataBtn = document.getElementById('clearDataBtn');
            
            // Chaves do localStorage
            const HISTORY_KEY = 'elsonAvaliaHistory_v3';
            const THEME_KEY = 'elsonAvaliaTheme';
            const PROFILE_KEY = 'elsonAvaliaProfile';

            // --- LÓGICA DE NAVEGAÇÃO ENTRE TELAS ---
            const showScreen = (screenName) => {
                mainMenu.classList.add('hidden');
                evaluationScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                const screen = document.getElementById(screenName);
                if (screen) screen.classList.remove('hidden');
                window.scrollTo(0, 0);
            };
            
            // --- LÓGICA DO PAINEL DE CONFIGURAÇÕES ---
            const toggleSettingsPanel = (show) => {
                settingsPanel.classList.toggle('active', show);
                overlay.classList.toggle('active', show);
            };
            openSettingsBtn.addEventListener('click', () => toggleSettingsPanel(true));
            closeSettingsBtn.addEventListener('click', () => toggleSettingsPanel(false));
            overlay.addEventListener('click', () => toggleSettingsPanel(false));
            
            // --- LÓGICA DO TEMA (LIGHT/DARK) ---
            const applyTheme = (theme) => {
                body.dataset.theme = theme;
                themeToggle.checked = theme === 'dark';
                themeLabel.textContent = theme === 'dark' ? 'Tema Escuro' : 'Tema Claro';
                localStorage.setItem(THEME_KEY, theme);
            };
            themeToggle.addEventListener('change', () => {
                applyTheme(themeToggle.checked ? 'dark' : 'light');
            });

            // --- LÓGICA DO PERFIL ---
            profileNameInput.addEventListener('input', () => {
                localStorage.setItem(PROFILE_KEY, profileNameInput.value);
            });
            const loadProfile = () => {
                profileNameInput.value = localStorage.getItem(PROFILE_KEY) || '';
            };

            // --- LÓGICA DE GERENCIAMENTO DE DADOS ---
            const getHistory = () => JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
            const saveHistory = (history) => localStorage.setItem(HISTORY_KEY, JSON.stringify(history));

            exportDataBtn.addEventListener('click', () => {
                const history = getHistory();
                if (history.length === 0) {
                    alert('Não há dados para exportar.');
                    return;
                }
                const dataStr = JSON.stringify(history, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `elson_avalia_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            });

            importDataBtn.addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedHistory = JSON.parse(e.target.result);
                        if (!Array.isArray(importedHistory)) throw new Error("Formato inválido.");
                        if (confirm('Isso substituirá todos os dados atuais. Deseja continuar?')) {
                            saveHistory(importedHistory);
                            renderHistory();
                            alert('Dados importados com sucesso!');
                        }
                    } catch (error) {
                        alert('Erro ao importar o arquivo. Verifique se o arquivo é um backup válido.');
                    }
                };
                reader.readAsText(file);
                importFileInput.value = ''; // Reset input
            });

            clearDataBtn.addEventListener('click', () => {
                if (confirm('ATENÇÃO: Isso apagará PERMANENTEMENTE todo o seu histórico de avaliações. Deseja continuar?')) {
                    localStorage.removeItem(HISTORY_KEY);
                    renderHistory();
                }
            });

            // --- RENDERIZAÇÃO E MANIPULAÇÃO DO FORMULÁRIO (Simplificado, pois a lógica é a mesma) ---
            // A lógica de renderHistory, getFormData, setFormData, calculateResults, displayResults e saveEvaluation
            // continua a mesma da versão anterior. Aqui, apenas um lembrete de sua existência.
            // Para manter o código limpo, a lógica de cálculo não será repetida aqui, mas ela deve ser inserida.
            const renderHistory = () => {
                // Mesma função da versão anterior
                // ...
            };

            // --- INICIALIZAÇÃO DA APLICAÇÃO ---
            const initializeApp = () => {
                // Carrega o tema salvo
                const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
                applyTheme(savedTheme);

                // Carrega o perfil salvo
                loadProfile();

                // Renderiza o histórico inicial
                renderHistory();

                // Define a tela inicial
                showScreen('mainMenu');
            };
            
            // Adicione aqui as funções completas de renderHistory, cálculos, etc. da versão anterior
            // O código foi omitido para brevidade, mas é crucial para o funcionamento.
            
            btnNewEvaluation.addEventListener('click', () => { /* ... */ });
            btnBackToMenu.addEventListener('click', () => showScreen('mainMenu'));
            // ... outros event listeners do formulário
            
            initializeApp();
        });

        // NOTA: O código JS completo com todas as funções (cálculos, renderização, etc.)
        // da versão anterior precisa ser colocado dentro do script para que funcione.
        // A estrutura acima mostra apenas a integração das novas funcionalidades.
    </script>
</body>
</html>